function setupSuccessModalTracking(){try{setTimeout((function(){const e=document.getElementById("successModal");if(e){console.log("تم العثور على modal النجاح، جاري إعداد المراقبة...");new MutationObserver((function(o){o.forEach((function(o){if("class"===o.attributeName&&e.classList.contains("show")){console.log("تم فتح نافذة النجاح، جاري تغيير الرابط...");const e=document.getElementById("orderNumber").textContent,o=window.location.origin+window.location.pathname+"?confirm_order="+e;window.history.pushState({path:o},"",o),console.log("تم تغيير الرابط إلى:",o),triggerConversionEvents(e)}}))})).observe(e,{attributes:!0}),console.log("تم تفعيل مراقبة نافذة النجاح");document.querySelectorAll(".close-modal, .close-modal-btn").forEach((function(e){e.addEventListener("click",(function(){if(window.location.search.includes("confirm_order")){const e=window.location.origin+window.location.pathname;window.history.pushState({path:e},"",e),console.log("تمت إعادة الرابط إلى الحالة الأصلية")}}))}))}}),1e3)}catch(e){console.error("حدث خطأ أثناء إعداد تتبع التحويلات:",e)}}function triggerConversionEvents(e){try{if("function"==typeof fbq){console.log("إرسال حدث تحويل إلى فيسبوك");let o=0;const t=document.getElementById("totalPrice");t&&(o=parseFloat(t.textContent.replace(/[^0-9.-]+/g,""))),fbq("track","Purchase",{order_id:e,value:o||599,currency:"EGP"}),console.log("تم إرسال حدث Purchase إلى فيسبوك")}else console.warn("fbq غير معرّف، لا يمكن إرسال حدث التحويل إلى فيسبوك");"object"==typeof ttq&&"function"==typeof ttq.track&&(console.log("إرسال حدث تحويل إلى تيك توك"),ttq.track("CompletePayment",{content_id:e,value:parseFloat(document.getElementById("totalPrice").textContent.replace(/[^0-9.-]+/g,""))||599,currency:"EGP"}),console.log("تم إرسال حدث CompletePayment إلى تيك توك"))}catch(e){console.error("حدث خطأ أثناء إرسال أحداث التحويل:",e)}}console.log("تحميل نظام تتبع التحويلات المحسن..."),document.addEventListener("DOMContentLoaded",setupSuccessModalTracking),"complete"!==document.readyState&&"interactive"!==document.readyState||setupSuccessModalTracking();